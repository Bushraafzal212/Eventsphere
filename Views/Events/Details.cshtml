@model EventSphere.Models.Event

@{
    ViewData["Title"] = Model.Title;
}

<div class="container">
    <div class="row">
        <div class="col-lg-8">
            <!-- Event Header -->
            <div class="card mb-4">
                @{
                    var imageService = ViewData["ImageService"] as EventSphere.Services.IImageService;
                    var imageUrl = imageService?.GetEventImageUrl(Model) ?? "https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=800&h=400&fit=crop";
                }
                <img src="@imageUrl" class="card-img-top" alt="@Model.Title" style="height: 300px; object-fit: cover;">
                
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <h1 class="card-title mb-0">@Model.Title</h1>
                        <span class="badge bg-primary fs-6">@Model.Category</span>
                    </div>
                    
                    <p class="lead text-muted">@Model.Description</p>
                    
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-calendar text-primary me-3" style="font-size: 1.5rem;"></i>
                                <div>
                                    <strong>Date</strong><br>
                                    @Model.EventDate.ToString("dddd, MMMM dd, yyyy")
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-clock text-primary me-3" style="font-size: 1.5rem;"></i>
                                <div>
                                    <strong>Time</strong><br>
                                    @Model.StartTime.ToString(@"hh\:mm") - @Model.EndTime.ToString(@"hh\:mm")
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-map-marker-alt text-primary me-3" style="font-size: 1.5rem;"></i>
                                <div>
                                    <strong>Venue</strong><br>
                                    @Model.Venue
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-building text-primary me-3" style="font-size: 1.5rem;"></i>
                                <div>
                                    <strong>Department</strong><br>
                                    @Model.OrganizingDepartment
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Event Details -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Event Details</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <strong>Event Type:</strong> @Model.EventType<br>
                            <strong>Organizer:</strong> @Model.OrganizerName<br>
                            <strong>Contact:</strong> @Model.OrganizerEmail
                        </div>
                        <div class="col-md-6">
                            <strong>Capacity:</strong> @Model.MaxCapacity participants<br>
                            <strong>Registered:</strong> @Model.CurrentRegistrations participants<br>
                            <strong>Available:</strong> @(Model.MaxCapacity - Model.CurrentRegistrations) spots
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reviews Section -->
            @if (Model.Reviews != null && Model.Reviews.Any())
            {
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-star me-2"></i>Reviews (@Model.Reviews.Count())</h5>
                    </div>
                    <div class="card-body">
                        @foreach (var review in Model.Reviews.Take(3))
                        {
                            <div class="border-bottom pb-3 mb-3">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <strong>@review.User.FirstName @review.User.LastName</strong>
                                    <div>
                                        @for (int i = 1; i <= 5; i++)
                                        {
                                            <i class="fas fa-star @(i <= review.OverallRating ? "text-warning" : "text-muted")"></i>
                                        }
                                    </div>
                                </div>
                                @if (!string.IsNullOrEmpty(review.Comment))
                                {
                                    <p class="text-muted mb-0">@review.Comment</p>
                                }
                            </div>
                        }
                        @if (Model.Reviews.Count() > 3)
                        {
                            <a href="#" class="btn btn-outline-primary btn-sm">View All Reviews</a>
                        }
                    </div>
                </div>
            }
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Registration Card -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-ticket-alt me-2"></i>Registration</h5>
                </div>
                <div class="card-body">
                    @if (Model.CurrentRegistrations >= Model.MaxCapacity)
                    {
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            This event is full. Join the waitlist!
                        </div>
                        @if (User.Identity?.IsAuthenticated == true)
                        {
                            <button class="btn btn-warning w-100" disabled>
                                <i class="fas fa-clock me-2"></i>Join Waitlist
                            </button>
                        }
                        else
                        {
                            <a asp-controller="Account" asp-action="Login" class="btn btn-warning w-100">
                                <i class="fas fa-sign-in-alt me-2"></i>Login to Join Waitlist
                            </a>
                        }
                    }
                    else
                    {
                        <div class="mb-3">
                            <div class="progress mb-2">
                                <div class="progress-bar" role="progressbar" 
                                     style="width: @((double)Model.CurrentRegistrations / Model.MaxCapacity * 100)%"
                                     aria-valuenow="@Model.CurrentRegistrations" 
                                     aria-valuemin="0" 
                                     aria-valuemax="@Model.MaxCapacity">
                                </div>
                            </div>
                            <small class="text-muted">
                                @Model.CurrentRegistrations of @Model.MaxCapacity spots filled
                            </small>
                        </div>

                        @if (User.Identity?.IsAuthenticated == true)
                        {
                            @if (ViewData["IsRegistered"] is bool isRegistered && isRegistered)
                            {
                                <div class="alert alert-success">
                                    <i class="fas fa-check-circle me-2"></i>
                                    You are registered for this event!
                                </div>
                                <form asp-action="CancelRegistration" method="post" class="mb-3">
                                    <input type="hidden" name="eventId" value="@Model.Id" />
                                    <div class="mb-2">
                                        <label for="reason" class="form-label">Cancellation Reason (Optional)</label>
                                        <textarea name="reason" id="reason" class="form-control" rows="2" placeholder="Why are you cancelling?"></textarea>
                                    </div>
                                    <button type="submit" class="btn btn-outline-danger w-100">
                                        <i class="fas fa-times me-2"></i>Cancel Registration
                                    </button>
                                </form>
                            }
                            else if (ViewData["CanRegister"] is bool canRegister && canRegister)
                            {
                                <form asp-action="Register" method="post">
                                    <input type="hidden" name="eventId" value="@Model.Id" />
                                    <button type="submit" class="btn btn-success w-100">
                                        <i class="fas fa-user-plus me-2"></i>Register Now
                                    </button>
                                </form>
                            }
                            else
                            {
                                <button class="btn btn-secondary w-100" disabled>
                                    <i class="fas fa-ban me-2"></i>Registration Not Available
                                </button>
                            }
                        }
                        else
                        {
                            <a asp-controller="Account" asp-action="Login" class="btn btn-primary w-100">
                                <i class="fas fa-sign-in-alt me-2"></i>Login to Register
                            </a>
                        }
                    }

                    @if (Model.CertificateFee > 0)
                    {
                        <div class="mt-3 p-3 bg-light rounded">
                            <h6 class="mb-2"><i class="fas fa-certificate me-2"></i>Certificate</h6>
                            <p class="mb-2 small text-muted">Digital certificate available after event completion</p>
                            <strong class="text-success">$@Model.CertificateFee</strong>
                        </div>
                    }
                    else
                    {
                        <div class="mt-3 p-3 bg-light rounded">
                            <h6 class="mb-2"><i class="fas fa-gift me-2"></i>Certificate</h6>
                            <p class="mb-2 small text-muted">Free digital certificate included</p>
                            <strong class="text-success">FREE</strong>
                        </div>
                    }
                </div>
            </div>

            <!-- Share Event -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-share-alt me-2"></i>Share Event</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-primary btn-sm">
                            <i class="fab fa-facebook me-2"></i>Share on Facebook
                        </button>
                        <button class="btn btn-outline-info btn-sm">
                            <i class="fab fa-twitter me-2"></i>Share on Twitter
                        </button>
                        <button class="btn btn-outline-success btn-sm">
                            <i class="fab fa-whatsapp me-2"></i>Share on WhatsApp
                        </button>
                        <button class="btn btn-outline-secondary btn-sm">
                            <i class="fas fa-calendar-plus me-2"></i>Add to Calendar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            @if (User.IsInRole("Organizer") || User.IsInRole("Admin"))
            {
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-cogs me-2"></i>Quick Actions</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-edit me-2"></i>Edit Event
                            </a>
                            <a href="#" class="btn btn-outline-info btn-sm">
                                <i class="fas fa-users me-2"></i>View Registrations
                            </a>
                            <a href="#" class="btn btn-outline-success btn-sm">
                                <i class="fas fa-qrcode me-2"></i>Generate QR Codes
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

